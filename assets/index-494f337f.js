import{t as q}from"./throttle-1cd3618f.js";import{d as J,f as o,g as oe,h as T,c as u,a as c,F as I,r as R,i as d,n as G,j as y,u as p,o as i,k as ae,l as se,m as B,t as ne}from"./index-38f91d3f.js";const re={key:0,class:"bg-layer"},ue={key:1,class:"bg-layer"},ie={class:"content-layer"},ve=J({__name:"InfiniteScroll",props:{defaultHighLightIndex:{default:0},duration:{default:3e3}},emits:["focus"],setup($,{expose:M,emit:s}){const k=$,_=o(),v=o(),C=o(),h=o(),Y=o(),f=o(),b=o(!1),a=o(0),n=o(0),r=o(0);oe(()=>{Q.observe(h.value,{childList:!0,attributes:!1}),A()});const g=o(!1),K=()=>{T(()=>{console.log("check"),g.value=!(_.value.clientHeight>a.value)})},Q=new MutationObserver(()=>{A()}),A=()=>{r.value=U(),a.value=h.value.clientHeight,n.value=a.value/r.value,K(),T(()=>{n.value!==0&&(console.log("check2",g.value),g.value?T(()=>{P()}):N.value&&(O(),F()))})},U=()=>{const e=h.value.children;for(let l=0;l<e.length;l+=1){const t=e[l];if(t.attributes.getNamedItem("type")&&t.attributes.getNamedItem("type").value==="infinite-scroll-item")return t.clientHeight}return 0},w=q(e=>{var m,z;if(n.value===0)return;let l=e.target,t=!1;for(;;)if(l.attributes.getNamedItem("type")&&((m=l.attributes.getNamedItem("type"))==null?void 0:m.value)==="infinite-scroll-item"){t=!0;break}else if(l.attributes.getNamedItem("type")&&((z=l.attributes.getNamedItem("type"))==null?void 0:z.value)==="infinite-scroll-container"){t=!1;break}else if(l.parentNode===null){t=!1;break}else l=l.parentNode;t&&(f.value.style.transform=`translateY(${l.offsetTop/r.value*r.value}px)`,s("focus",l.offsetTop/r.value%n.value))},100),H=o(0),X=()=>{H.value=v.value.scrollTop,b.value=!0,L.value=!1,D()},Z=()=>{b.value=!1,W(),V()},S=o(),L=o(!1),ee=()=>{const e=v.value.scrollTop;e>=a.value&&(v.value.scrollTop=e-a.value,H.value=e-a.value),!b.value&&T(()=>{P()})},E=q(()=>{S.value!==void 0&&(window.clearTimeout(S.value),S.value=void 0);const e=v.value.scrollTop,l=e>H.value;b.value&&(l?e>=a.value&&(v.value.scrollTop=e-a.value,H.value=e-a.value):e<a.value&&(v.value.scrollTop=e+a.value,H.value=e+a.value)),L.value&&(S.value=window.setTimeout(()=>{L.value=!1,ee()},200))},50),te=()=>{const e=v.value.scrollTop,l=e+r.value-e%r.value;L.value=!0,v.value.scrollTo({left:0,top:l,behavior:"smooth"})},P=()=>{if(n.value===0)return;const t=v.value.scrollTop%a.value/r.value+k.defaultHighLightIndex,m=t%n.value;t>0&&m===0?(f.value.style.transform=`translateY(${t*r.value}px)`,setTimeout(()=>{T(()=>{f.value.style.transform=`translateY(${m*r.value}px)`})},50)):f.value.style.transform=`translateY(${m*r.value}px)`,s("focus",m)},N=o(!1),x=o(),V=()=>{N.value&&n.value!==0&&(x.value!==void 0&&window.clearInterval(x.value),x.value=window.setInterval(()=>{g.value?te():le()},k.duration))},D=()=>{x.value!==void 0&&window.clearInterval(x.value)},F=()=>{n.value!==0&&(N.value=!0,V())},O=()=>{N.value=!1,D()},W=()=>{const e=Number(/translateY\((\d+)px\)/.exec(f.value.style.transform)[1]);console.log(e),e>=a.value&&T(()=>{f.value.style.transform=`translateY(${e%a.value}px)`})},j=e=>{f.value.style.transform=`translateY(${e*r.value}px)`},le=()=>{if(console.log("othermove"),n.value===0)return;const e=Number(/translateY\((\d+)px\)/.exec(f.value.style.transform)[1])/r.value;e===n.value-1?(s("focus",0),j(0)):(s("focus",e+1),j(e+1))};return M({startAutoMove:F,stopAutoMove:O,resetHighLightPosition:W}),(e,l)=>(i(),u("div",{class:"container",ref_key:"containerRef",ref:_,type:"infinite-scroll-container"},[c("div",{class:"for-hide-scroll-bar view-window",onScroll:l[3]||(l[3]=(...t)=>p(E)&&p(E)(...t)),onMouseenter:X,onMouseleave:Z,ref_key:"viewWindowRef",ref:v},[g.value?(i(),u("div",re,[(i(!0),u(I,null,R(Math.ceil(n.value*3/2),t=>(i(),u(I,{key:`bg-${t}`},[d(e.$slots,"darkBg",{type:"dark"+t},void 0,!0),t<=n.value*3?d(e.$slots,"lightBg",{key:0,type:"light"+t},void 0,!0):y("",!0)],64))),128))])):(i(),u("div",ue,[(i(!0),u(I,null,R(Math.ceil(n.value/2),t=>(i(),u(I,{key:`bg-${t}`},[d(e.$slots,"darkBg",{type:"dark"+t},void 0,!0),t<=n.value?d(e.$slots,"lightBg",{key:0,type:"light"+t},void 0,!0):y("",!0)],64))),128))])),n.value>0?(i(),u("div",{key:2,class:"high-light-layer",ref_key:"highLightRef",ref:f,style:{transform:"translateY(0px)"}},[c("div",null,[d(e.$slots,"highLightBg",{},void 0,!0)]),g.value?(i(),u("div",{key:0,style:G({marginTop:a.value-r.value+"px"})},[d(e.$slots,"highLightBg",{},void 0,!0)],4)):y("",!0),g.value?(i(),u("div",{key:1,style:G({marginTop:a.value-r.value+"px"})},[d(e.$slots,"highLightBg",{},void 0,!0)],4)):y("",!0)],512)):y("",!0),c("div",ie,[g.value?(i(),u("div",{key:0,class:"top",ref_key:"topRef",ref:C,onMousemove:l[0]||(l[0]=(...t)=>p(w)&&p(w)(...t))},[d(e.$slots,"default",{},void 0,!0)],544)):y("",!0),c("div",{class:"mid",ref_key:"midRef",ref:h,onMousemove:l[1]||(l[1]=(...t)=>p(w)&&p(w)(...t))},[d(e.$slots,"default",{},void 0,!0)],544),g.value?(i(),u("div",{key:1,class:"bottom",ref_key:"bottomRef",ref:Y,onMousemove:l[2]||(l[2]=(...t)=>p(w)&&p(w)(...t))},[d(e.$slots,"default",{},void 0,!0)],544)):y("",!0)])],544)],512))}});const ce=($,M)=>{const s=$.__vccOpts||$;for(const[k,_]of M)s[k]=_;return s},fe=ce(ve,[["__scopeId","data-v-cc348307"]]),de={class:"h-[120px] w-20"},ge=c("div",{class:"h-6 w-20 bg-slate-300"},null,-1),pe=c("div",{class:"h-6 w-20 bg-slate-100"},null,-1),he=c("div",{class:"h-6 w-20 bg-red-200"},null,-1),me={class:"h-6 w-20",type:"infinite-scroll-item"},_e=J({__name:"index",setup($){const M=o(new Array(3).fill(0)),s=o(),k=()=>{s.value&&s.value.resetHighLightPosition()},_=()=>{s.value&&s.value.startAutoMove()},v=()=>{s.value&&s.value.stopAutoMove()},C=h=>{console.log("聚焦到了",h,"项")};return(h,Y)=>(i(),u("div",null,[ae(" 无限滚动组件 "),c("button",{onClick:_},"run"),c("button",{onClick:v},"stop"),c("button",{onClick:k},"test"),c("div",de,[se(fe,{ref_key:"infiniteScrollComp",ref:s,"default-high-light-index":2,onFocus:C},{darkBg:B(()=>[ge]),lightBg:B(()=>[pe]),highLightBg:B(()=>[he]),default:B(()=>[(i(!0),u(I,null,R(M.value,(f,b)=>(i(),u("div",me,[c("span",null,"插槽"+ne(b),1)]))),256))]),_:1},512)])]))}});export{_e as default};
